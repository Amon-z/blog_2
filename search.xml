<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Apache学习笔记</title>
    <url>/2022/01/05/Apache%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>学习Linux Apache服务做的笔记，方便自己查阅与复习。</p>
<span id="more"></span>

<h1 id="Apache学习笔记"><a href="#Apache学习笔记" class="headerlink" title="Apache学习笔记"></a>Apache学习笔记</h1><h2 id="安装Apache"><a href="#安装Apache" class="headerlink" title="安装Apache"></a>安装Apache</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install httpd</span><br><span class="line">systemctl start httpd    //启动</span><br><span class="line">systemctl enable httpd    //设为开机启动</span><br></pre></td></tr></table></figure>

<p>访问：浏览器访问127.0.0.1。</p>
<p>配置文件：</p>
<img title="" src="./Apache学习笔记/1.png" alt="" width=100%>

<p>常用参数：</p>
<img title="" src="./Apache学习笔记/2.png" alt="" width=100%>

<h2 id="更改网站目录"><a href="#更改网站目录" class="headerlink" title="更改网站目录"></a>更改网站目录</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mkdir /home/wwwroot //创建文件夹</span><br><span class="line">$ echo &quot;homepage&quot; &gt; /home/wwwroot/index.html  //创建主页</span><br><span class="line">$ vim /etc/httpd/conf/httpd.conf   //编辑配置文件</span><br><span class="line">    DocumentRoot &quot;/var/www/html&quot; -&gt; DocumentRoot &quot;/home/wwwroot&quot;</span><br><span class="line">    &lt;Directory &quot;/var/www&quot;&gt;  -&gt; &lt;Directory &quot;/home/wwwroot&quot;&gt;</span><br><span class="line">$ ls -Zd /var/www/html    </span><br><span class="line">$ ls -Zd /home/wwwroot    //查看两个目录的selinux安全上下文不同之处</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/* //设置selinux安全上下文</span><br><span class="line">$ restorecon -Rv /home/wwwroot   //立即生效</span><br></pre></td></tr></table></figure>

<h2 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ vim /etc/selinux</span><br><span class="line">    enforcing    //强制启用安全策略模式，将拦截服务的不合法请求。</span><br><span class="line">    permissive   //遇到服务越权访问时，只发出警告而不强制拦截</span><br><span class="line">    disabled     //对于越权的行为不警告也不拦截</span><br><span class="line">$ getenforce    //查看运行状态</span><br><span class="line">$ setenforce 1    //启用，0为禁用。临时，重启后失效</span><br><span class="line">$ semanage    //用于管理selinux策略，l 查询，a 添加，m 修改，d 删除。</span><br></pre></td></tr></table></figure>

<h2 id="个人用户主页功能"><a href="#个人用户主页功能" class="headerlink" title="个人用户主页功能"></a>个人用户主页功能</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ vim /etc/httpd/conf.d/userdir.conf    //编辑配置文件</span><br><span class="line">    UserDir disable   -&gt;   # UserDir disable</span><br><span class="line">    # UserDir public_html   -&gt;   UserDir public_html</span><br><span class="line">$ su amon   //切换用户</span><br><span class="line">$ mkdir ~/public_html    //创建网站文件夹</span><br><span class="line">$ echo &quot;amon&#x27;homepage&quot; &gt; ~/public_html/index.html   //创建主页文件</span><br><span class="line">$ chomd -Rf 755 /home/amon    //设置文件夹权限</span><br><span class="line">$ getsebool -a | grep http    //查找selinux安全域策略</span><br><span class="line">$ setsebool -P httpd_enable_homedirs=on   //修改selinux安全域策略，参数P：永久设置并立即生效</span><br></pre></td></tr></table></figure>

<p>访问：浏览器访问127.0.0.1/~amon</p>
<h5 id="添加身份验证"><a href="#添加身份验证" class="headerlink" title="添加身份验证"></a>添加身份验证</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ htpasswd -c /etc/httpd/passwd amon  //c参数表示第一次生成，存放密码的文件、用户名称</span><br><span class="line">$ vim /etc/httpd/conf.d/userdir.conf    //修改配置文件</span><br><span class="line">    &lt;Directory &quot;/home/*/public_html&quot;&gt; </span><br><span class="line">        AllowOverride all </span><br><span class="line">        authuserfile &quot;/etc/httpd/passwd&quot;    //密码文件</span><br><span class="line">        authname &quot;My privately website&quot;    //访问网页提示</span><br><span class="line">        authtype basic</span><br><span class="line">        require user amon    //用户进行登录需要验证的用户名称</span><br><span class="line">    &lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<h2 id="虚拟主机功能"><a href="#虚拟主机功能" class="headerlink" title="虚拟主机功能"></a>虚拟主机功能</h2><h5 id="基于IP地址"><a href="#基于IP地址" class="headerlink" title="基于IP地址"></a>基于IP地址</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ vim /etc/sysconfig/network-scripts/ifcfg-ens33   //设置多个IP地址</span><br><span class="line">    ADDRIP0=192.168.10.11</span><br><span class="line">    ADDRIP1=192.168.10.12</span><br><span class="line">    ADDRIP2=192.168.10.13</span><br><span class="line">$ mkdir /home/wwwroot    //创建主页</span><br><span class="line">$ mkdir /home/wwwroot/11</span><br><span class="line">$ mkdir /home/wwwroot/12</span><br><span class="line">$ mkdir /home/wwwroot/13</span><br><span class="line">$ echo &quot;IP:192.168.10.11&quot; &gt; /home/wwwroot/11/index.html</span><br><span class="line">$ echo &quot;IP:192.168.10.12&quot; &gt; /home/wwwroot/12/index.html</span><br><span class="line">$ echo &quot;IP:192.168.10.13&quot; &gt; /home/wwwroot/13/index.html</span><br><span class="line">$ vim /etc/httpd/conf/httpd.conf    //编辑配置文件</span><br><span class="line">    &lt;VirualHost 192.168.10.11&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/11</span><br><span class="line">        ServerName www.amonlinux.com</span><br><span class="line">        &lt;Directory /home/wwwroot/11&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">    &lt;VirualHost 192.168.10.12&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/12</span><br><span class="line">        ServerName bbs.amonlinux.com</span><br><span class="line">        &lt;Directory /home/wwwroot/12&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">    &lt;VirualHost 192.168.10.13&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/13</span><br><span class="line">        ServerName tech.amonlinux.com</span><br><span class="line">        &lt;Directory /home/wwwroot/13&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot   //selinux安全上下文</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/11</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/11/*</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/12</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/12/*</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/13</span><br><span class="line">$ semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/13/*</span><br><span class="line">$ restorecon -Rv /home/wwwroot    //立即生效</span><br></pre></td></tr></table></figure>

<p>访问：浏览器访问192.168.10.11、192.168.10.12、192.168.10.13</p>
<h5 id="基于主机域名"><a href="#基于主机域名" class="headerlink" title="基于主机域名"></a>基于主机域名</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mkdir /home/wwwroot    //创建主页</span><br><span class="line">$ mkdir /home/wwwroot/www</span><br><span class="line">$ mkdir /home/wwwroot/bbs</span><br><span class="line">$ mkdir /home/wwwroot/tech</span><br><span class="line">$ echo &quot;www&quot; &gt; /home/wwwroot/www/index.html</span><br><span class="line">$ echo &quot;bbs&quot; &gt; /home/wwwroot/bbs/index.html</span><br><span class="line">$ echo &quot;tech&quot; &gt; /home/wwwroot/tech/index.html</span><br><span class="line">$ vim /etc/hosts    //手工定义 IP 地址与域名之间的对应关系</span><br><span class="line">    192.168.10.11  www.amonlinux.com bbs.amonlinux.com tech.amonlinux.com</span><br><span class="line">$ vim /etc/httpd/conf/httpd.conf    //编辑配置文件</span><br><span class="line">    &lt;VirualHost 192.168.10.11&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/www</span><br><span class="line">        ServerName &quot;www.amonlinux.com&quot;</span><br><span class="line">        &lt;Directory /home/wwwroot/www&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">    &lt;VirualHost 192.168.10.11&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/bbs</span><br><span class="line">        ServerName &quot;bbs.amonlinux.com&quot;</span><br><span class="line">        &lt;Directory /home/wwwroot/bbs&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">    &lt;VirualHost 192.168.10.11&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/tech</span><br><span class="line">        ServerName &quot;tech.amonlinux.com&quot;</span><br><span class="line">        &lt;Directory /home/wwwroot/tech&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">$ 设置selinux安全上下文（略）</span><br></pre></td></tr></table></figure>

<p>访问：浏览器访问<a class="link"   href="http://www.amonlinux.com、bbs.amonlinux.com、tech.amonlinux.com/" >www.amonlinux.com、bbs.amonlinux.com、tech.amonlinux.com<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="基于端口号"><a href="#基于端口号" class="headerlink" title="基于端口号"></a>基于端口号</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mkdir -p /home/wwwroot/6111    //创建主页</span><br><span class="line">$ mkdir -p /home/wwwroot/6222</span><br><span class="line">$ echo &quot;port:6111&quot; &gt; /home/wwwroot/6111/index.html</span><br><span class="line">$ echo &quot;port:6222&quot; &gt; /home/wwwroot/6222/index.html</span><br><span class="line">$ vim /etc/httpd/conf/httpd.conf</span><br><span class="line">    Listen 6111</span><br><span class="line">    Listen 6222</span><br><span class="line">    &lt;VirualHost 192.168.10.11:6111&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/6111</span><br><span class="line">        ServerName www.amonlinux.com</span><br><span class="line">        &lt;Directory /home/wwwroot/6111&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">    &lt;VirualHost 192.168.10.11:6222&gt;</span><br><span class="line">        DocumentRoot /home/wwwroot/6222</span><br><span class="line">        ServerName www.amonlinux.com</span><br><span class="line">        &lt;Directory /home/wwwroot/6111&gt;</span><br><span class="line">            AllowOverride none</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">    &lt;/VirualHost&gt;</span><br><span class="line">$ 设置SELinux安全上下文（略）</span><br><span class="line">$ semanage port -l | grep http   //查询过滤http协议相关且SELinux服务允许的端口</span><br><span class="line">$ semanage port -a -t httpd_port_t -p tcp 6111  //添加端口</span><br><span class="line">$ semanage port -a -t httpd_port_t -p tcp 6222</span><br><span class="line">$ systemctl restart httpd</span><br></pre></td></tr></table></figure>

<p>访问：浏览器访问192.168.10.11:6111 、192.168.10.11:6222</p>
<h2 id="Apache的访问控制"><a href="#Apache的访问控制" class="headerlink" title="Apache的访问控制"></a>Apache的访问控制</h2><p>Apache 可以基于源主机名、源 IP 地址或源主机上的浏览器特征等信息对网站上的资源进行访问控制。它通过 Allow 指令允许某个主机访问服务器上的网站资源，通过 Deny 指令实现禁止访问。在允许或禁止访问网站资源时，还会用到 Order 指令，这个指令用来定义 Allow或 Deny 指令起作用的顺序，其匹配原则是按照顺序进行匹配，若匹配成功则执行后面的默认指令。比如“Order Allow, Deny”表示先将源主机与允许规则进行匹配，若匹配成功则允许访问请求，反之则拒绝访问请求。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Apache</tag>
      </tags>
  </entry>
</search>
